<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>PrimeFlight | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/cadastro.css" />
  <link rel="icon" href="./assets/icon/icone_jordan_preto.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
</head>

<body>
  <div class="container">
    <div class="left-img">
      <img src="./assets/icon/icone_jordan _branco.png" alt="Icone Jordan">
    </div>
    <div class="right-form">
      <div class="header-box">
        <ul class="navbar">
          <li>
            <a href="index.html">HOME</a>
          </li>
          <li>
            <a href="#">HISTÓRIA</a>
          </li>
          <li>
            <a href="quiz.html">QUIZZ</a>
          </li>
          <li class="agora">
            <a href="#">CADASTRO</a>
          </li>
          <li>
            <a href="login.html">LOGIN</a>
          </li>
        </ul>
      </div>
      <div class="login">
        <div class="form-box">
          <div class="card-cadastro">
            <h2>INSIRA SUAS INFORMAÇÕES PESSOAIS PARA CRIAR SUA CONTA</h2>
            <div class="formulario">

              <div class="campo">
                <div class="msg_informacao"> Nome: </div>
                <input type="text" id="ipt_nome" onkeyup="onkey_nome()">
                <div class="msg_erro" id="div_msg_nome"></div>
              </div>

              <div class="campo">
                <div class="msg_informacao"> Email: </div>
                <input type="text" id="ipt_email" onkeyup="onkey_email()" placeholder="meuemail@provedor.com">
                <div class="msg_erro" id="div_msg_email"></div>
              </div>

              <div class="campo">
                <div class="msg_informacao"> Senha: </div>
                <div class="div_senha">
                  <input type="password" id="ipt_senha" onkeyup="onkey_senha()" placeholder="******">
                  <img src="./assets/imgs/olho-aberto-senha.png" alt="Mostrar senha" class="olho-senha"
                    onclick="mostrarSenha('ipt_senha', this)">
                </div>
                <div class="msg_erro" id="div_msg_senha"></div>
              </div>

              <div class="campo">
                <div class="msg_informacao"> Confirmação de senha: </div>
                <div class="div_senha">
                  <input type="password" id="ipt_confirmacaoSenha" onkeyup="onkey_conf_senha()" placeholder="******">
                  <img src="./assets/imgs/olho-aberto-senha.png" alt="Mostrar senha" class="olho-senha"
                    onclick="mostrarSenha('ipt_confirmacaoSenha', this)">
                </div>
                <div class="msg_erro" id="div_msg_conf_senha"></div>
              </div>

              <div class="campo">
                <span>Qual Air Jordan de sua Preferência:</span>
                <select id="escolhaTenis">
                  <option value="#">Selecione...</option>
                  <option value="Air Jordan 1">Air Jordan 1</option>
                  <option value="Air Jordan 3">Air Jordan 3</option>
                  <option value="Air Jordan 5">Air Jordan 5</option>
                  <option value="Air Jordan 11">Air Jordan 11</option>
                </select>
              </div>
              <div class="confirmacao">
                <span>JÁ TEM UMA CONTA? <a href="login.html">ENTRAR</a></span>
              </div>
              <button class="botao" onclick="cadastrar()">Cadastrar</button>
            </div>
            <div id="div_aguardar" class="loading-div">
              <img src="./assets/loading.webp" id="loading-gif" />
            </div>
          </div>
        </div>
      </div>
    </div>

</body>

</html>

<script>
  function mostrarSenha(idInput, icone) {
    const input = document.getElementById(idInput);

    if (input.type == "password") {
      input.type = "text";
      icone.src = "./assets/imgs/olho-fechado-senha.png";
    } else {
      input.type = "password";
      icone.src = "./assets/imgs/olho-aberto-senha.png";
    }
  }

  var chknome = false;
  var chkemail = false;
  var chksenha = false;
  var chkconfsenha = false;
  var chkpreferencia = false;

  function onkey_email() {
    email = ipt_email.value.trim();
    let erro = "";

    if (email == '') {
      erro = `Preencha o campo Email`;
    } else if (email.indexOf("@") == -1) {
      erro = `Insira um email válido que contenha @`;
    }

    if (erro != "") {
      div_msg_email.innerHTML = `${erro}`;
      chkemail = false;
    } else {
      div_msg_email.innerHTML = ``;
      chkemail = true;
    }
  }

  function onkey_senha() {
    var senha = ipt_senha.value.trim();
    var contador = 0;
    var temMaiuscula = false;

    while (contador < senha.length) {
      var letra = senha[contador];

      if (letra >= "A" && letra <= "Z") {
        temMaiuscula = true;
        break;
      }
      contador++;
    }

    let erro = "";

    if (senha == '') {
      erro = `Preencha o campo Senha`;
    }

    else if (senha.indexOf("0") == -1 && senha.indexOf("1") == -1 && senha.indexOf("2") == -1 &&
      senha.indexOf("3") == -1 && senha.indexOf("4") == -1 && senha.indexOf("5") == -1 &&
      senha.indexOf("6") == -1 && senha.indexOf("7") == -1 && senha.indexOf("8") == -1 &&
      senha.indexOf("9") == -1) {
      erro = 'A senha deve conter pelo menos um número!';
    }

    else if (!temMaiuscula) {
      erro = 'A senha deve conter pelo menos uma letra maiúscula!';
    }

    else if (senha.indexOf("!") == -1 && senha.indexOf("@") == -1 && senha.indexOf("#") == -1 && senha.indexOf("$") == -1 && senha.indexOf("%") == -1 && senha.indexOf("&") == -1) {
      erro = 'A senha deve conter pelo menos <br>um caractere especial (!, @, #, $, %, &)';
    }

    else if (senha.length < 8) {
      erro = 'A senha deve ter pelo menos 8 caracteres!'
    }

    if (erro != "") {
      div_msg_senha.innerHTML = `${erro}`;
      chksenha = false;
    } else {
      div_msg_senha.innerHTML = ``;
      chksenha = true;
    }
  }

  function onkey_nome() {
    nome = ipt_nome.value.trim();
    let erro = "";

    if (nome == '') {
      erro = `Preencha o campo Nome`;
    }

    if (erro != "") {
      div_msg_nome.innerHTML = `${erro}`;
      chknome = false;
    } else {
      div_msg_nome.innerHTML = ``;
      chknome = true;
    }
  }

  function onkey_conf_senha() {
    senha = ipt_senha.value.trim();
    senha_conf = ipt_confirmacaoSenha.value.trim();
    let erro = "";

    if (senha_conf == '') {
      erro = `Preencha o campo Confirmação de Senha`;
    } else if (senha != senha_conf) {
      erro = 'As senhas digitadas são diferentes. <br>Por favor, verifique e tente novamente.'
    }

    if (erro != "") {
      div_msg_conf_senha.innerHTML = `${erro}`;
      chksenha_conf = false;
    } else {
      div_msg_conf_senha.innerHTML = ``;
      chksenha_conf = true;
    }
  }

  function cadastrar() {
    if (escolhaTenis.value == '#') {
      alert('Escolha um Air Jordan de sua preferência')
      chkpreferencia = false;
    }
    else if (escolhaTenis.value != '#') {
      var axresposta = prompt(`O ${escolhaTenis.value} é a sua escolha? (Sim/Não)`)
      chkpreferencia = false
      if (axresposta == 'Sim') {
        chkpreferencia = true;
      } else {
        alert('Escolha um Air Jordan de sua preferência')
        chkpreferencia = false
        escolhaTenis.value = '#'
      }
    }

    onkey_nome();
    onkey_email();
    onkey_senha();
    onkey_conf_senha();

    const temErro = chknome &&
      chkemail &&
      chksenha &&
      chksenha_conf &&
      chkpreferencia


    if (!temErro) {
      alert("Verifique se todos os campos estão preenchidos!");
      return false;
    } else {
      var nomeVar = ipt_nome.value;
      var emailVar = ipt_email.value;
      var senhaVar = ipt_senha.value;
      var preferenciaVar = escolhaTenis.value;

      aguardar();

      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
          escolhaServer: preferenciaVar
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {

            alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");

            setTimeout(() => {
              window.location = "login.html";
            }, "2000");

          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

      return false;

    }
  }
</script>